<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Longan Map ‚Äî Northern Thailand</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    /* Fix map height */
    #map {
      width: 100%;
      height: 100%;
      min-height: 400px;
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <div class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="w-full border-b bg-white shadow-sm">
      <div class="max-w-6xl mx-auto px-4 py-3 flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between">
        <div>
          <h1 class="text-xl sm:text-2xl font-semibold text-emerald-700">
            ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≥‡πÑ‡∏¢‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ (Longan Map)
          </h1>
          <p class="text-xs sm:text-sm text-slate-600">
            ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡∏≥‡πÑ‡∏¢‡πÉ‡∏ô‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡∏î‡πâ‡∏ß‡∏¢ Leaflet + OpenStreetMap + Nominatim
          </p>
        </div>
        <div class="text-right text-xs sm:text-sm text-slate-700">
          <!-- üîß ‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏´‡∏±‡∏™‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
          ‡∏ä‡∏∑‡πà‡∏≠: <span id="studentName">‡∏™‡∏°‡∏°‡∏ï‡∏¥ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</span><br />
          ‡∏£‡∏´‡∏±‡∏™: <span id="studentId">6604xxxxxx</span>
        </div>
      </div>
    </header>

    <!-- Main layout -->
    <main class="flex-1 max-w-6xl mx-auto w-full px-4 py-4">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 h-[75vh]">
        <!-- Left: Form & list -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-4 flex flex-col gap-4">
          <h2 class="text-base sm:text-lg font-semibold text-emerald-700 flex items-center gap-2">
            ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
          </h2>

          <!-- Form -->
          <form id="markerForm" class="space-y-3 text-sm">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-medium text-slate-600 mb-1">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (Province)</label>
                <input
                  type="text"
                  id="province"
                  class="w-full rounded-lg border border-slate-300 px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-emerald-400"
                  placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà"
                  required
                />
              </div>
              <div>
                <label class="block text-xs font-medium text-slate-600 mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà (Place)</label>
                <input
                  type="text"
                  id="place"
                  class="w-full rounded-lg border border-slate-300 px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-emerald-400"
                  placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏•‡∏≤‡∏î‡∏™‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏¢"
                />
              </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-medium text-slate-600 mb-1">
                  ‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.) [Price]
                </label>
                <input
                  type="number"
                  step="0.01"
                  id="price"
                  class="w-full rounded-lg border border-slate-300 px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-emerald-400"
                  placeholder="‡πÄ‡∏ä‡πà‡∏ô 35.50"
                  required
                />
              </div>
              <div>
                <label class="block text-xs font-medium text-slate-600 mb-1">
                  ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏£‡∏ß‡∏à [Date]
                </label>
                <input
                  type="date"
                  id="date"
                  class="w-full rounded-lg border border-slate-300 px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-emerald-400"
                  required
                />
              </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label class="block text-xs font-medium text-slate-600 mb-1">
                  Latitude (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                </label>
                <input
                  type="number"
                  id="lat"
                  step="0.0001"
                  class="w-full rounded-lg border border-slate-300 px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-emerald-400"
                  placeholder="‡πÄ‡∏ä‡πà‡∏ô 18.7883"
                />
              </div>
              <div>
                <label class="block text-xs font-medium text-slate-600 mb-1">
                  Longitude (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                </label>
                <input
                  type="number"
                  id="lng"
                  step="0.0001"
                  class="w-full rounded-lg border border-slate-300 px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-emerald-400"
                  placeholder="‡πÄ‡∏ä‡πà‡∏ô 98.9853"
                />
              </div>
            </div>

            <p class="text-[11px] text-slate-500">
              * ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà Latitude/Longitude ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏ä‡πâ Geocoding ‡∏à‡∏≤‡∏Å Province + Place (Nominatim) ‡πÅ‡∏•‡∏∞‡πÅ‡∏Ñ‡∏ä‡∏ú‡∏•‡πÉ‡∏ô LocalStorage
            </p>

            <div class="flex flex-wrap gap-2 pt-1">
              <button
                type="submit"
                class="inline-flex items-center justify-center px-3 py-1.5 rounded-lg bg-emerald-500 text-white text-sm font-medium hover:bg-emerald-600 transition"
              >
                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î (Add Marker)
              </button>
              <button
                type="button"
                id="fitAllBtn"
                class="inline-flex items-center justify-center px-3 py-1.5 rounded-lg border border-emerald-300 text-emerald-700 text-xs font-medium hover:bg-emerald-50"
              >
                ‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î (Fit all markers)
              </button>
              <button
                type="button"
                id="clearCacheBtn"
                class="inline-flex items-center justify-center px-3 py-1.5 rounded-lg border border-rose-300 text-rose-700 text-xs font-medium hover:bg-rose-50"
              >
                ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡∏ä Geocoding
              </button>
            </div>
          </form>

          <!-- Sample usage -->
          <div class="mt-2 border-t border-slate-200 pt-2 text-xs space-y-1">
            <div class="font-semibold text-slate-700">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå:</div>
            <ul class="list-disc list-inside text-slate-600">
              <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà" ‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏á‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 18.7883, 98.9853</li>
              <li>‡∏Å‡∏£‡∏≠‡∏Å "‡∏ï‡∏•‡∏≤‡∏î‡∏™‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏¢", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", lat=18.8056, lng=99.0105</li>
            </ul>
          </div>

          <!-- List markers -->
          <div class="mt-2 flex-1 overflow-auto border-t border-slate-200 pt-2">
            <h3 class="text-xs font-semibold text-slate-700 mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°</h3>
            <ul id="markerList" class="space-y-1 text-xs text-slate-700 max-h-40 overflow-y-auto"></ul>
          </div>
        </section>

        <!-- Right: Map -->
        <section class="lg:col-span-2 rounded-xl overflow-hidden border border-slate-200 shadow-sm bg-slate-100">
          <div id="map"></div>
        </section>
      </div>
    </main>
  </div>

  <script>
    // üîß ‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‚Äì‡∏™‡∏Å‡∏∏‡∏•‚Äì‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
    const STUDENT_NAME = "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏†‡∏≤‡∏™‡∏£‡∏ì‡πå ‡πÅ‡∏™‡∏ô‡∏Ç‡∏±‡∏¢"; // TODO: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á
    const STUDENT_ID = "6604101347";       // TODO: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏à‡∏£‡∏¥‡∏á

    document.getElementById("studentName").textContent = STUDENT_NAME;
    document.getElementById("studentId").textContent = STUDENT_ID;

    // ------------------------------
    // 1) ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠
    // ------------------------------
    const map = L.map("map").setView([18.7883, 98.9853], 8); // Chiang Mai, zoom 8

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "&copy; OpenStreetMap contributors",
    }).addTo(map);

    // Green marker icon
    const greenIcon = new L.Icon({
      iconUrl:
        "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",
      shadowUrl:
        "https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41],
    });

    // ‡πÄ‡∏Å‡πá‡∏ö marker ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏•‡∏∞ bounds
    const markers = [];
    const bounds = L.latLngBounds();

    const markerListEl = document.getElementById("markerList");

    // ------------------------------
    // Helper: ‡∏™‡∏£‡πâ‡∏≤‡∏á popup content
    // ------------------------------
    function buildPopupContent(data) {
      const placeLabel = data.place ? data.place : "(‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà)";
      const provinceLabel = data.province ? data.province : "(‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)";
      const priceLabel = data.price ? data.price : "-";
      const dateLabel = data.date ? data.date : "-";

      return `
        <div style="font-size: 12px;">
          <strong>${placeLabel} - ${provinceLabel}</strong><br/>
          ‡∏£‡∏≤‡∏Ñ‡∏≤: ${priceLabel} ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.<br/>
          ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏£‡∏ß‡∏à: ${dateLabel}<br/>
          ‡πÇ‡∏î‡∏¢: ${STUDENT_NAME} (${STUDENT_ID})
        </div>
      `;
    }

    // ------------------------------
    // Helper: ‡πÄ‡∏û‡∏¥‡πà‡∏° marker ‡∏•‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
    // ------------------------------
    function addMarker(data, fit = true) {
      const marker = L.marker([data.lat, data.lng], { icon: greenIcon });
      marker.bindPopup(buildPopupContent(data));

      marker.on("click", () => {
        marker.setPopupContent(buildPopupContent(data));
      });

      marker.addTo(map);

      markers.push({ marker, data });
      bounds.extend([data.lat, data.lng]);

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô sidebar
      const li = document.createElement("li");
      li.textContent = `${data.place || data.province || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"} | ‡∏£‡∏≤‡∏Ñ‡∏≤ ${data.price} | ${data.date}`;
      li.className =
        "px-2 py-1 rounded-md bg-emerald-50 border border-emerald-100 cursor-pointer hover:bg-emerald-100";
      li.onclick = () => {
        map.setView([data.lat, data.lng], 12);
        marker.openPopup();
      };
      markerListEl.appendChild(li);

      if (fit && markers.length > 0) {
        map.fitBounds(bounds.pad(0.2));
      }

      return marker;
    }

    // ------------------------------
    // Helper: Geocoding + Cache
    // ------------------------------
    async function geocodePlace(province, place) {
      const query = place ? `${place}, ${province}, Thailand` : `${province}, Thailand`;
      const cacheKey = `geo_cache_${encodeURIComponent(query)}`;

      // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≤‡∏Å LocalStorage ‡∏Å‡πà‡∏≠‡∏ô
      const cached = localStorage.getItem(cacheKey);
      if (cached) {
        try {
          const parsed = JSON.parse(cached);
          if (parsed && parsed.lat && parsed.lng) {
            return parsed;
          }
        } catch (e) {
          console.warn("Invalid cache:", e);
        }
      }

      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ cache ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Nominatim
      const url =
        "https://nominatim.openstreetmap.org/search?format=json&limit=1&q=" +
        encodeURIComponent(query);

      const res = await fetch(url, {
        headers: {
          "Accept-Language": "th,en;q=0.8",
        },
      });
      const data = await res.json();
      if (!data || data.length === 0) {
        throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏≤‡∏Å Nominatim");
      }

      const lat = parseFloat(data[0].lat);
      const lng = parseFloat(data[0].lon);

      const result = { lat, lng };
      localStorage.setItem(cacheKey, JSON.stringify(result));

      return result;
    }

    // ------------------------------
    // ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î
    // ------------------------------
    const form = document.getElementById("markerForm");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const province = document.getElementById("province").value.trim();
      const place = document.getElementById("place").value.trim();
      const price = document.getElementById("price").value.trim();
      const date = document.getElementById("date").value;
      const latStr = document.getElementById("lat").value.trim();
      const lngStr = document.getElementById("lng").value.trim();

      let lat, lng;

      try {
        if (latStr && lngStr) {
          // ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á
          lat = parseFloat(latStr);
          lng = parseFloat(lngStr);
        } else {
          // ‡πÉ‡∏ä‡πâ Geocoding ‡∏à‡∏≤‡∏Å province + place
          const geo = await geocodePlace(province, place);
          lat = geo.lat;
          lng = geo.lng;
        }

        const markerData = {
          province,
          place,
          price,
          date,
          lat,
          lng,
        };

        addMarker(markerData, true);

        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô province (‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏ä‡∏≠‡∏ö)
        // form.reset();
      } catch (err) {
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î: " + err.message);
        console.error(err);
      }
    });

    // ‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏ó‡∏∏‡∏Å marker
    document.getElementById("fitAllBtn").addEventListener("click", () => {
      if (markers.length > 0) {
        map.fitBounds(bounds.pad(0.2));
      } else {
        alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà");
      }
    });

    // ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á cache geocoding
    document.getElementById("clearCacheBtn").addEventListener("click", () => {
      Object.keys(localStorage).forEach((key) => {
        if (key.startsWith("geo_cache_")) {
          localStorage.removeItem(key);
        }
      });
      alert("‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡∏ä Geocoding ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
    });

    // ------------------------------
    // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå
    // ------------------------------
    // 9.1) ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà
    addMarker(
      {
        province: "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà",
        place: "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà",
        price: "35.50",
        date: "2023-08-15",
        lat: 18.7883,
        lng: 98.9853,
      },
      false
    );

    // 9.2) ‡∏ï‡∏•‡∏≤‡∏î‡∏™‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏¢ - ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà
    addMarker(
      {
        province: "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà",
        place: "‡∏ï‡∏•‡∏≤‡∏î‡∏™‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏¢",
        price: "35.50",
        date: "2023-08-15",
        lat: 18.8056,
        lng: 99.0105,
      },
      false
    );

    if (markers.length > 0) {
      map.fitBounds(bounds.pad(0.2));
    }
  </script>
</body>
</html>